{% extends 'base.html' %}
{% block content %}
<div class="p-3">
  <div class="container">
    <div class="row mt-3">
      <div class="col mx-auto mb-3">
        <h1>Petitions</h1>
        <hr />

        <h2>Create Petition</h2>
        <form method="POST">
          {% csrf_token %}
          <p>
            <label for="petition">Comment:</label>
            <textarea name="petition" required class="form-control" id="petition"></textarea>
          </p>
          <div class="text-start">
            <button type="submit" class="btn bg-dark text-white">
                Create Petition
            </button>
          </div>
        </form>
        <hr />
        <h2>Existing Petitions</h2>
        {% for item in template_data.petitions_data %}
          <div class="card mb-2">
            <div class="card-body">
              <h5 class="card-title">{{ item.petition.petition }}</h5>
              <p class="card-text text-muted">By {{ item.petition.user.username }} â€” {{ item.petition.date }}</p>
              <p>
                Yes: <strong>{{ item.yes }}</strong>
                &nbsp;|&nbsp;
                No: <strong>{{ item.no }}</strong>
              </p>

              {% if user.is_authenticated %}
                <form method="POST" class="d-inline">
                  {% csrf_token %}
                  <input type="hidden" name="petition_id" value="{{ item.petition.id }}" />
                  <input type="hidden" name="choice" value="1" />
                  <button type="submit" class="btn btn-sm btn-success" {% if item.user_vote == 1 %}disabled{% endif %}>Vote Yes</button>
                </form>
                <form method="POST" class="d-inline ms-2">
                  {% csrf_token %}
                  <input type="hidden" name="petition_id" value="{{ item.petition.id }}" />
                  <input type="hidden" name="choice" value="0" />
                  <button type="submit" class="btn btn-sm btn-danger" {% if item.user_vote == 0 %}disabled{% endif %}>Vote No</button>
                </form>
                {% if item.user_vote is not None %}
                  <span class="ms-2">Your vote: {% if item.user_vote == 1 %}Yes{% else %}No{% endif %}</span>
                {% endif %}
              {% else %}
                <p><em>Log in to vote</em></p>
              {% endif %}
            </div>
          </div>
        {% empty %}
          <p>No petitions yet.</p>
        {% endfor %}
      </div>
    </div>
  </div>  
</div>
{% endblock content %}